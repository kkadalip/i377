<?xml version="1.0" ?>
<project name="kkadalip" default="compile" basedir="." >
    <description>
        Minu elu esimene ANT-i build fail
    </description>
	
	<property name="src.dir" location="src" />
	<property name="build.dir" location="build" />
	<property name="classes.dir" location="${build.dir}/classes" />
	<property name="lib.dir" location="${webContent.dir}/WEB-INF/lib" />
	<property name="webContent.dir" location="WebContent" />
	<property name="war.file" location="whatever.war" />
	
	<property name="managerUrl" value="http://localhost:8080/manager/text" />
	<property name="managerUsername" value="tomcat" />
	<property name="managerPassword" value="tomcat" />
	<property name="deployContextPath" value="/apache-tomcat-7.0.42/" />
	
	<property name="src.tests" location="src/tests" />
	<property name="build.tests" location="build/classes/tests" />
	<property name="reports.tests" location="" />
	<property name="java.class.path" location="${lib.dir};src/Homework2Test.java" />

	<property name="managerUsername" value="karl" />
		
	<property file="user.properties" location="user.properties" />
	
	<target name="compile" depends="clean, init">
		<classpath id="compile.classpath">
			<fileset dir="${lib.dir}">
				<include name="*.jar" />
			</fileset>
		</classpath>
		<javac srcdir="${src.dir}"
		   	   destdir="${classes.dir}"
			   source="1.6"
			   target="1.6"
			   includeantruntime="false"/>
		<classpath refid="compile.classpath" />
	</target>

	<target name="init">
		<mkdir dir="${classes.dir}" />
	</target>
	
	<target name="clean">
		<delete dir="${build.dir}" />
	</target>
	
	<target name="war" depends="compile">
		<war destfile="${war.file}"
		webxml="${webContent.dir}/WEBINF/web.xml">
		<classes dir="${classes.dir}" />
		<fileset dir="${webContent.dir}"
			excludes="**/servletapi.jar" />
		</war>
	</target>
	
	<target name="test">
		<junit printsummary="yes" haltonfailure="yes">
			<path>
				<pathelement location="${build.tests}"/>
				<pathelement path="${java.class.path}"/>
			</path>
			<formatter type="plain"/>
			<test name="my.test.TestCase" haltonfailure="no" outfile="result">
				<formatter type="xml"/>
			</test>
			<batchtest fork="no" todir="${reports.tests}">
			<fileset dir="${src.tests}">
				<include name="**/*Test*.java"/>
				<exclude name="**/*Util.java"/>
			</fileset>
			</batchtest>
		</junit>
	</target>
	
	<target name="deploy" depends="war">
		<path id="classpath.tomcat">
			<fileset dir="${dir.tomcat}/lib">
				<include name="*.jar" />
				</fileset>
					<fileset dir="${dir.tomcat}/bin">
				<include name="*.jar" />
			</fileset>
		</path>
		<taskdef name="deploy"
		         classname="org.apache.catalina.ant.DeployTask"
		         classpathref="classpath.tomcat"/>
		<deploy url="${managerUrl}"
		username="${managerUsername}"
		password="${managerPassword}"
		path="${deployContextPath}"
		update="true" war="file:${war.file}" />
	</target>
	
	<target name="undeploy">
		<taskdef name="undeploy"
		         classname="org.apache.catalina.ant.UndeployTask"
		         classpathref="classpath.tomcat" />
		<undeploy url="${managerUrl}"
		username="${managerUsername}"
		password="${managerPassword}"
		path="${deployContextPath}" />
	</target>
		
</project>